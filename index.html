<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chicken Status</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#101a33;
      --text:#e8ecff;
      --muted:#a8b2d1;
      --ok:#2bd576;
      --busy:#ffcc00;
      --err:#ff5c7a;
      --link:#8ab4ff;
    }
    body{
      margin:0;
      font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
      background:radial-gradient(1200px 700px at 20% 10%, rgba(138,180,255,.14), transparent 60%),
                 radial-gradient(1200px 700px at 80% 30%, rgba(43,213,118,.10), transparent 55%),
                 linear-gradient(180deg,#070a14, var(--bg));
      color:var(--text);
      overflow-x:hidden;
    }

    /* Background animation: subtle when IDLE, more energetic when WORKING */
    .bgfx{
      position:fixed; inset:-40% -40%;
      background:
        radial-gradient(closest-side, rgba(255,204,0,.18), transparent 60%) 20% 20%/40% 40% no-repeat,
        radial-gradient(closest-side, rgba(138,180,255,.22), transparent 60%) 75% 35%/45% 45% no-repeat,
        radial-gradient(closest-side, rgba(43,213,118,.18), transparent 60%) 55% 75%/45% 45% no-repeat;
      filter: blur(40px);
      opacity:.35;
      transform: translate3d(0,0,0);
      pointer-events:none;
      animation: drift 18s ease-in-out infinite;
    }
    @keyframes drift{
      0%{ transform: translate(-2%, -1%) scale(1.02); }
      50%{ transform: translate(2%, 1%) scale(1.06); }
      100%{ transform: translate(-2%, -1%) scale(1.02); }
    }

    body[data-state="WORKING"] .bgfx{
      opacity:.55;
      animation: drift 10s ease-in-out infinite;
    }

    body[data-state="ERROR"] .bgfx{
      opacity:.55;
      filter: blur(46px) saturate(1.2);
    }

    .wrap{max-width:980px;margin:0 auto;padding:48px 18px;position:relative;}

    .hero{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      text-align:center;
      padding:10px 0 6px;
    }

    .chicken{
      font-size:140px;
      line-height:1;
      filter: drop-shadow(0 18px 40px rgba(0,0,0,.45));
      transform: translateZ(0);
      user-select:none;
    }

    .label{
      margin-top:10px;
      font-size:34px;
      font-weight:800;
      letter-spacing:.3px;
    }

    .label small{
      display:block;
      font-size:14px;
      font-weight:600;
      color:var(--muted);
      margin-top:8px;
    }

    body[data-state="WORKING"] .chicken{ animation: run 650ms ease-in-out infinite; }
    @keyframes run{
      0%{ transform: translateY(0) rotate(-2deg); }
      50%{ transform: translateY(-10px) rotate(2deg); }
      100%{ transform: translateY(0) rotate(-2deg); }
    }

    body[data-state="IDLE"] .chicken{ animation: rest 2.8s ease-in-out infinite; }
    @keyframes rest{
      0%,100%{ transform: translateY(0) scale(1); opacity: .95; }
      50%{ transform: translateY(2px) scale(0.99); opacity: 1; }
    }

    body[data-state="ERROR"] .chicken{ animation: shake .25s ease-in-out 0s 2; }

    .card{
      position:relative;
      background:rgba(16,26,51,.82);
      border:1px solid rgba(138,180,255,.20);
      border-radius:18px;
      padding:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
    }

    /* Card glow changes by state */
    .card::before{
      content:"";
      position:absolute; inset:-1px;
      border-radius:18px;
      padding:1px;
      background:linear-gradient(120deg, rgba(138,180,255,.25), rgba(255,255,255,.03), rgba(43,213,118,.18));
      -webkit-mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor;
      mask-composite: exclude;
      pointer-events:none;
      opacity:.9;
    }

    body[data-state="WORKING"] .card::before{
      background:linear-gradient(120deg, rgba(255,204,0,.38), rgba(138,180,255,.22), rgba(255,92,122,.10));
      animation: borderPulse 1.8s ease-in-out infinite;
    }
    @keyframes borderPulse{ 0%,100%{opacity:.55} 50%{opacity:1} }

    body[data-state="ERROR"] .card{
      animation: shake .25s ease-in-out 0s 2;
    }
    @keyframes shake{
      0%{transform:translateX(0)}
      25%{transform:translateX(3px)}
      50%{transform:translateX(-3px)}
      75%{transform:translateX(2px)}
      100%{transform:translateX(0)}
    }

    h1{margin:0 0 6px 0;font-size:22px;}
    .sub{color:var(--muted); font-size:14px; margin-bottom:16px;}
    .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center;}

    /* Status pill */
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:999px;
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.08)
    }

    /* The fun bit: dot becomes animated ring when WORKING */
    .dotWrap{
      position:relative;
      width:12px; height:12px;
      display:inline-block;
    }
    .dot{
      width:12px; height:12px;
      border-radius:999px;
      background:var(--muted);
      box-shadow:0 0 0 0 rgba(168,178,209,.25);
    }

    body[data-state="IDLE"] .dot{
      animation: breathe 2.2s ease-in-out infinite;
    }
    @keyframes breathe{
      0%,100%{ transform:scale(1); box-shadow:0 0 0 0 rgba(43,213,118,.18); }
      50%{ transform:scale(1.12); box-shadow:0 0 0 10px rgba(43,213,118,0); }
    }

    /* WORKING: spinning ring around dot */
    .ring{
      position:absolute; inset:-6px;
      border-radius:999px;
      background:conic-gradient(from 0deg, rgba(255,204,0,1), rgba(138,180,255,1), rgba(255,92,122,.9), rgba(255,204,0,1));
      filter: blur(.2px);
      opacity:0;
      transform:translateZ(0);
    }
    .ring::after{
      content:"";
      position:absolute; inset:2px;
      border-radius:999px;
      background:rgba(16,26,51,.95);
    }

    body[data-state="WORKING"] .ring{
      opacity:1;
      animation: spin 1s linear infinite;
    }
    @keyframes spin{ to{ transform: rotate(360deg); } }

    body[data-state="WORKING"] .dot{
      background: var(--busy);
      box-shadow: 0 0 18px rgba(255,204,0,.35);
    }

    body[data-state="ERROR"] .dot{
      background: var(--err);
      animation: errPulse 1.2s ease-in-out infinite;
      box-shadow:0 0 18px rgba(255,92,122,.35);
    }
    @keyframes errPulse{ 0%,100%{transform:scale(1)} 50%{transform:scale(1.14)} }

    .kv{margin-top:14px;display:grid;grid-template-columns:160px 1fr; gap:10px 14px; font-size:14px;}
    .k{color:var(--muted)}
    a{color:var(--link)}
    .foot{margin-top:18px;color:var(--muted);font-size:12px}
    code{background:rgba(255,255,255,.06); padding:2px 6px; border-radius:6px}

    .taskText{max-width:520px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
  </style>
</head>
<body data-state="UNKNOWN">
  <div class="bgfx" aria-hidden="true"></div>

  <div class="wrap">
    <div class="card">
      <div class="hero">
        <div class="chicken" id="chicken" aria-hidden="true">üêî</div>
        <div class="label" id="label">Loading‚Ä¶<small id="task">‚Äî</small></div>
      </div>

      <div class="row" style="justify-content:center;">
        <div class="pill">
          <span class="dotWrap" aria-hidden="true">
            <span class="ring" id="ring"></span>
            <span class="dot" id="dot"></span>
          </span>
          <strong id="state">Loading‚Ä¶</strong>
        </div>
      </div>

      <div class="kv">
        <div class="k">Last update</div><div id="updated">‚Äî</div>
        <div class="k">Last heartbeat age</div><div id="age">‚Äî</div>
        <div class="k">Source</div><div><a id="jsonLink" href="status.json">status.json</a></div>
      </div>

      <div class="foot">This page polls <code>status.json</code> every 5 seconds (cache-busted).</div>
    </div>
  </div>

<script>
  const dot = document.getElementById('dot');
  const stateEl = document.getElementById('state');
  const taskEl = document.getElementById('task');
  const labelEl = document.getElementById('label');
  const chickenEl = document.getElementById('chicken');
  const updatedEl = document.getElementById('updated');
  const ageEl = document.getElementById('age');

  function fmt(ts){
    if(!ts) return '‚Äî';
    const d = new Date(ts);
    return d.toLocaleString();
  }

  function age(ts){
    if(!ts) return '‚Äî';
    const ms = Date.now() - new Date(ts).getTime();
    const s = Math.max(0, Math.floor(ms/1000));
    if(s < 60) return s+'s';
    const m = Math.floor(s/60);
    if(m < 60) return m+'m '+(s%60)+'s';
    const h = Math.floor(m/60);
    return h+'h '+(m%60)+'m';
  }

  async function tick(){
    try{
      const r = await fetch('status.json?cb='+Date.now(), {cache:'no-store'});
      const j = await r.json();
      const st = (j.state || 'UNKNOWN').toUpperCase();
      document.body.dataset.state = st;

      const task = (j.task && j.task.trim()) ? j.task.trim() : '';

      // map machine state -> chicken UI
      let label = st;
      let chicken = 'üêî';
      if(st === 'WORKING') { label = 'RUNNING'; chicken = 'üêî'; }
      else if(st === 'IDLE') { label = 'RESTING'; chicken = 'üê£'; }
      else if(st === 'ERROR') { label = 'ERROR'; chicken = 'üêî'; }
      else { label = st; chicken = 'üêî'; }

      stateEl.textContent = label;
      chickenEl.textContent = chicken;
      labelEl.firstChild.nodeValue = label;
      taskEl.textContent = task ? task : '‚Äî';
      updatedEl.textContent = fmt(j.updatedAt);
      ageEl.textContent = age(j.updatedAt);

      // keep a sensible dot color in case CSS doesn‚Äôt load
      if(st === 'WORKING') dot.style.background = 'var(--busy)';
      else if(st === 'IDLE') dot.style.background = 'var(--ok)';
      else if(st === 'ERROR') dot.style.background = 'var(--err)';
      else dot.style.background = 'var(--muted)';

    } catch(e){
      document.body.dataset.state = 'ERROR';
      stateEl.textContent = 'ERROR';
      chickenEl.textContent = 'üêî';
      labelEl.firstChild.nodeValue = 'ERROR';
      taskEl.textContent = 'Failed to load status.json';
      dot.style.background = 'var(--err)';
    }
  }

  tick();
  setInterval(tick, 5000);
</script>
</body>
</html>
